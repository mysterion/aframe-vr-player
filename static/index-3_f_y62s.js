(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const P="controlsHidden",T="controlsShown",R="E_Controls";AFRAME.registerComponent("controls",{init:function(){this.system.register(this.el)},remove:function(){this.system.unregister(this.el)}});AFRAME.registerSystem("controls",{init:function(){this.entities=[],this.clickables=[]},register:function(e){this.entities.push(e)},unregister:function(e){var t=this.entities.indexOf(e);this.entities.splice(t,1)},hideControls:function(){for(let e in this.entities){let t=this.entities[e];this.clickables.push(t.hasAttribute("clickable")),this.clickables.at(-1)&&t.removeAttribute("clickable"),t.object3D.visible=!1}this.el.emit(R,P,!1)},showControls:function(){for(let e in this.entities){let t=this.entities[e];this.clickables[e]&&t.setAttribute("clickable",""),t.object3D.visible=!0}this.clickables=[],this.el.emit(R,T,!1)}});function O(e,t){return e==="#FFF"&&(t*=-1),"#"+e.replace(/^#/,"").replace(/../g,i=>("0"+Math.min(255,Math.max(0,parseInt(i,16)+t)).toString(16)).substr(-2))}function x(e){isNaN(e)&&(e=0);var t=new Date(null);return t.setSeconds(e),t.toISOString().substr(11,8)}function H(e){return e.replace(/^.*[\\/]/,"")}function L(e="a-entity",t={},i=[]){const r=document.createElement(e);for(let s in t)r.setAttribute(s,t[s]);return i.length>0&&r.append(...i),r}function G(e){for(const t in e)return!1;return!0}function $(e){return document.querySelector("#"+e)}function Q(e,{width:t,height:i,depth:r}){var s=document.createElement("a-entity");return s.setAttribute("geometry",{primitive:"box",width:t,height:i,depth:r}),s.setAttribute("material",{color:"#4CC3D9"}),e.appendChild(s),s}function q(e){var t=document.createElement("a-text");return t.setAttribute("position","0 0.3 0"),t.setAttribute("align","center"),t.setAttribute("value","00:00:00"),e.appendChild(t),t}function J(e,{width:t,height:i,depth:r}){var s=document.createElement("a-entity");let n=e.getAttribute("position");return s.setAttribute("visible",!1),s.setAttribute("geometry",{primitive:"box",width:t,height:i,depth:r}),s.setAttribute("position",n),s.setAttribute("material",{color:"#00FF00"}),e.insertAdjacentElement("afterend",s),s}function Y(e){let{width:t,height:i}=e.getAttribute("geometry"),r=e.getAttribute("position");var s=document.createElement("a-entity");s.setAttribute("geometry",{primitive:"plane",width:t+.05,height:i+.05}),s.setAttribute("material",{color:O(e.getAttribute("material").color,-40)}),s.setAttribute("position",r)}function X(e){var t=document.createElement("a-entity");return t.setAttribute("position","0 0 0"),t.setAttribute("geometry",{primitive:"plane",width:1.5,height:.15}),t.setAttribute("text",{value:"00:00:00/00:00:00",width:2,align:"center"}),t.setAttribute("material",{color:"#333",opacity:.5}),e.appendChild(t),t}AFRAME.registerComponent("timeline",{schema:{videoId:{type:"string",default:"video"}},init:function(){var e=this.el;this.video=document.getElementById(this.data.videoId);let{width:t,height:i}=e.getAttribute("geometry");this.seek=Q(e,{width:t*.015,height:i,depth:.015}),this.hoverEl=J(this.seek,{width:t*.01,height:i+.01,depth:.01}),this.hoverTextEl=q(this.hoverEl),this.bg=Y(e),this.videoText=X(e),this.timelineWidth=timeline.getAttribute("geometry").width,this.seek.setAttribute("position",{x:-this.timelineWidth/2}),this.updateElems=()=>{var r=this.video.currentTime/this.video.duration*this.timelineWidth-this.timelineWidth/2;this.seek.setAttribute("position",{x:r}),this.videoText.setAttribute("text",{value:`${x(this.video.currentTime)}/${x(this.video.duration)}`})},this.video.addEventListener("loadedmetadata",()=>{this.seek.setAttribute("position",{x:-this.timelineWidth/2}),this.videoText.setAttribute("text",{value:`${x(this.video.currentTime)}/${x(this.video.duration)}`})}),this.video.addEventListener("timeupdate",this.updateElems),e.addEventListener("click",r=>{let s=this.video;if(s.readyState===0){console.log("no info available for video");return}var n=r.detail.intersection.uv.x;s.currentTime=(n*s.duration).toFixed(2)}),e.addEventListener("raycaster-intersected",r=>{this.raycaster=r.detail.el,this.hoverEl.setAttribute("visible",!0)}),e.addEventListener("raycaster-intersected-cleared",r=>{this.raycaster=null,this.hoverEl.setAttribute("visible",!1)})},tick:function(){var d,h,b;if(!this.raycaster)return;let e=this.raycaster.components.raycaster.getIntersection(this.el);if(!e||e.point.x===((d=this.previousIntersection)==null?void 0:d.x)&&e.point.y===((h=this.previousIntersection)==null?void 0:h.y)&&e.point.z===((b=this.previousIntersection)==null?void 0:b.z))return;let t=e.uv.x,i=timeline.getAttribute("geometry").width,r=t*i-i/2,s=Math.floor(t*video.duration),{y:n,z:l}=this.hoverEl.getAttribute("position");this.hoverEl.setAttribute("position",`${r} ${n} ${l}`),this.hoverTextEl.setAttribute("value",x(s)),this.previousIntersection=e.point},remove:function(){var e=this.el;e.setAttribute("controls")}});AFRAME.registerComponent("stereocam",{schema:{eye:{type:"string",default:"left"}},init:function(){this.layer_changed=!1},tick:function(e){var t=this.data;if(!this.layer_changed){var i;this.el.object3D.children.forEach(function(r){r.type=="PerspectiveCamera"&&(i=r)}),i?t.eye==="left"?(i.layers.enable(1),i.layers.disable(2)):t.eye==="right"?(i.layers.enable(2),i.layers.disable(1)):(i.layers.enable(1),i.layers.enable(2)):console.error("stereocam: Camera not found")}}});AFRAME.registerComponent("button-highlight",{init:function(){this.color=this.el.getAttribute("material").color,this.el.addEventListener("raycaster-intersected",e=>{this.el.setAttribute("material",{color:O(this.color,40)})}),this.el.addEventListener("raycaster-intersected-cleared",e=>{this.el.setAttribute("material",{color:this.color})})}});AFRAME.registerComponent("recenter",{schema:{},init:function(){var e=this.el;this.camera=document.getElementById("camera"),this.recenterCamera=!1,this.controlsVisible=!0,e.sceneEl.addEventListener("enter-vr",()=>{this.recenterCamera=!0}),e.sceneEl.addEventListener("exit-vr",()=>{this.recenterCamera=!1}),e.sceneEl.addEventListener(R,t=>{t.detail===P?this.controlsVisible=!1:t.detail===T&&(this.controlsVisible=!0)}),e.addEventListener("click",t=>{if(t.detail.intersectedEl===e){if(!this.controlsVisible){e.sceneEl.systems.controls.showControls();return}this.recenterCamera&&e.setAttribute("rotation",{y:-this.camera.getAttribute("rotation").y})}})}});AFRAME.registerComponent("cursor-util",{schema:{},init:function(){let e=this.el;this.cursorChild=document.createElement("a-entity"),this.cursorChild.setAttribute("geometry","primitive: circle; radius: 0.0075;"),this.cursorChild.setAttribute("material","color: teal"),e.removeAttribute("geometry"),this.checkVR(),e.sceneEl.addEventListener("enter-vr",AFRAME.utils.bind(this.checkVR,this)),e.sceneEl.addEventListener("exit-vr",AFRAME.utils.bind(this.checkVR,this))},checkVR:function(){let e=this.el;AFRAME.utils.device.checkVRSupport()?(e.setAttribute("geometry","primitive: ring; radiusInner: 0.005; radiusOuter: 0.0075;"),e.setAttribute("material","color: white;"),e.appendChild(this.cursorChild)):(e.setAttribute("cursor","rayOrigin: mouse"),e.replaceChildren())}});const F={EQ:"equirectangular",FE:"fisheye"},E={EQ_180_SBS:"EQ_180_SBS",FE_180_SBS:"FE_180_SBS",FE_190_SBS:"FE_190_SBS",FE_200_SBS:"FE_200_SBS"};AFRAME.registerComponent("env-manager",{schema:{mode:{type:"string",default:E.EQ_180_SBS},uiHidden:{type:"boolean",default:!1},defaultEye:{type:"string",default:"left"}},init:function(){this.currentMode=null,this.onUIHide=AFRAME.utils.bind(this.onUIHide,this),this.el.sceneEl.addEventListener(R,this.onUIHide)},update:function(e){let t=this.data,i=this.el;switch(this.currentMode!==null&&this.currentMode!==e.mode&&i.removeAttribute(this.currentMode),t.mode){case E.EQ_180_SBS:i.setAttribute(F.EQ,{uiHidden:t.uiHidden,defaultEye:t.defaultEye}),this.currentMode=F.EQ;break;case E.FE_180_SBS:i.setAttribute(F.FE,{uiHidden:t.uiHidden,defaultEye:t.defaultEye}),this.currentMode=F.FE;break;case E.FE_190_SBS:i.setAttribute(F.FE,{uiHidden:t.uiHidden,defaultEye:t.defaultEye,fov:190}),this.currentMode=F.FE;break;case E.FE_200_SBS:i.setAttribute(F.FE,{uiHidden:t.uiHidden,defaultEye:t.defaultEye,fov:200}),this.currentMode=F.FE;break;default:console.error("preset not found")}},onUIHide:function(e){e.detail===P?this.el.setAttribute("env-manager","uiHidden: true"):e.detail===T&&this.el.setAttribute("env-manager","uiHidden: false")}});const m="video-state",w=[{text:"180 SBS EQR",fn:()=>{o.env.setAttribute("env-manager",{mode:E.EQ_180_SBS})}},{text:"180 SBS FISH",fn:()=>{o.env.setAttribute("env-manager",{mode:E.FE_180_SBS})}},{text:"190 SBS FISH",fn:()=>{o.env.setAttribute("env-manager",{mode:E.FE_190_SBS})}},{text:"200 SBS FISH",fn:()=>{o.env.setAttribute("env-manager",{mode:E.FE_200_SBS})}}];AFRAME.registerComponent(m,{schema:{src:{type:"string",default:"static/sample.mp4"},fileName:{type:"string",default:"sample.mp4"},preset:{type:"number",default:0}},init:function(){this.currentTime=AFRAME.utils.bind(this.currentTime,this)},update:function(e){var t=this.data;w[t.preset].fn(),e.src!==t.src&&e.src&&(o.video.src=t.src,o.video.play()),this.el.emit(m,{data:t,od:e})}});AFRAME.registerComponent("toggle-mode",{init:function(){this.el.addEventListener("click",()=>{let e=o.ascene.getAttribute(m).preset;o.ascene.setAttribute(m,{preset:(e+1)%w.length})}),o.ascene.addEventListener(m,e=>{let t=e.detail.data;this.el.setAttribute("value",w[t.preset].text)})}});AFRAME.registerComponent("adjust-camera",{init:function(){let e=this.el;e.sceneEl.addEventListener("enter-vr",function(){e.setAttribute("position",{y:-1.6})}),e.sceneEl.addEventListener("exit-vr",function(){e.setAttribute("position",{y:0})})}});const v=function(){return{get:i=>JSON.parse(localStorage.getItem(i)),set:(i,r)=>{localStorage.setItem(i,JSON.stringify(r))}}}(),M="apply-settings-vid";AFRAME.registerComponent(M,{schema:{time:{type:"boolean",default:!1},defaultPreset:{type:"number",default:0},savePreset:{type:"boolean",default:!0}},init:function(){this.timeKey="",this.presetKey="",this.videoName="",this.lastUpdate=Date.now(),this.onVideoLoad=AFRAME.utils.bind(this.onVideoLoad,this),this.saveVidTime=AFRAME.utils.bind(this.saveVidTime,this),this.onVideoStateChange=AFRAME.utils.bind(this.onVideoStateChange,this),o.video.readyState>=1&&(this.videoName=o.ascene.getAttribute(m).fileName,this.timeKey=`VID_T_${this.videoName}`,this.presetKey=`VID_P_${this.videoName}`),o.video.addEventListener("loadedmetadata",this.onVideoLoad),o.ascene.addEventListener(m,this.onVideoStateChange)},update:function(e){var t=this.data;t.time?o.video.addEventListener("timeupdate",this.saveVidTime):o.video.removeEventListener("timeupdate",this.saveVidTime)},remove:function(){o.video.removeEventListener("timeupdate",this.saveVidTime),o.video.removeEventListener("loadedmetadata",this.onVideoLoad)},onVideoLoad:function(){if(this.videoName=o.ascene.getAttribute(m).fileName,this.timeKey=`VID_T_${this.videoName}`,this.presetKey=`VID_P_${this.videoName}`,this.lastUpdate=Date.now(),this.data.time){let e=v.get(this.timeKey);e&&(o.video.currentTime=e)}},onVideoStateChange:function(e){if(this.data.savePreset){let{data:t,od:i}=e.detail,r=`VID_P_${t.fileName}`;if(t.fileName!==i.fileName){let s=v.get(r);s!=null?o.ascene.setAttribute(m,{preset:s}):o.ascene.setAttribute(m,{preset:this.data.defaultPreset})}else v.set(r,t.preset)}else o.ascene.setAttribute(m,{preset:this.data.defaultPreset})},saveVidTime:function(){let e=Date.now();e-this.lastUpdate>5e3&&(this.lastUpdate=e,v.set(this.timeKey,o.video.currentTime))}});const B=[0,30,45,60,90,60,45,30],y="apply-settings";AFRAME.registerComponent(y,{schema:{resumeVideo:{type:"boolean",default:!0},defaultPreset:{type:"number",default:0},savePreset:{type:"boolean",default:!0},defaultEye:{type:"string",default:"left"},viewAngle:{type:"number",default:0}},init:function(){let e=this.el,t=v.get("settings");if(!t)t=this.data,v.set("settings",t);else{let i={};for(let r in this.data)r in t||(i[r]=this.data[r]);G(i)||v.set("settings",{...t,...i}),e.setAttribute(y,t)}},update:function(e){let t=this.el,i=this.data;t.setAttribute(M,{time:i.resumeVideo}),t.setAttribute(M,{defaultPreset:i.defaultPreset}),t.setAttribute(M,{savePreset:i.savePreset}),$("camera").setAttribute("stereocam",{eye:i.defaultEye}),$("env").setAttribute("env-manager",{defaultEye:i.defaultEye}),o.cameraRig.setAttribute("rotation",`-${B[i.viewAngle]} 0 0`),this.el.emit(y,i,!1),v.set("settings",i)}});AFRAME.registerComponent("toggle-view-angle",{init:function(){this.i=0,this.el.addEventListener("click",AFRAME.utils.bind(()=>{this.i=(this.i+1)%B.length,o.ascene.setAttribute(y,{viewAngle:this.i})},this)),o.ascene.addEventListener(y,AFRAME.utils.bind(e=>{this.el.setAttribute("value",B[e.detail.viewAngle??0]),this.i=e.detail.viewAngle}))}});function j(e){return new Promise((t,i)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>i(e.error)})}function z(e,t){const i=indexedDB.open(e);i.onupgradeneeded=()=>i.result.createObjectStore(t);const r=j(i);return(s,n)=>r.then(l=>n(l.transaction(t,s).objectStore(t)))}let V;function Z(){return V||(V=z("keyval-store","keyval")),V}function ee(e,t=Z()){return t("readwrite",i=>(i.delete(e),j(i.transaction)))}const te="https://192.168.1.50:5000/list",ie="https://192.168.1.50:5000/file",g="dialog-files",p=6,S=-.23,_=.5;function N(e,t,i,r){let s=document.createElement("a-image");s.setAttribute("src",e),s.setAttribute("position",i),s.setAttribute("background-color","blue"),s.setAttribute("scale",r),t.appendChild(s)}async function se(e,t){e.setAttribute("dialog-loading","");let i=await fetch(te+"/"+t),{files:r,folders:s}=await i.json();e.setAttribute(g,{filesFolders:{files:r,folders:s}}),e.removeAttribute("dialog-loading")}function re(e,t,i,r,s){var c,f;let n=((c=s[t])==null?void 0:c.files)??0,l=((f=s[t])==null?void 0:f.folders)??0,d=document.createElement("a-text"),h=e.getAttribute("geometry");d.setAttribute("value","folder://"+t),d.setAttribute("geometry",`primitive:plane; width:${h.width}; height: 0.2`),d.setAttribute("position",`0 ${h.height/2} 0.01`),d.setAttribute("material","color: grey"),d.setAttribute("align","center"),d.setAttribute("width","2"),e.appendChild(d),N("#asset-movie-icon",e,"-2.35 0 0.01","0.25 0.25 1"),N("#asset-folder",e,"2.35 0 0.01","0.25 0.25 1");let b=document.createElement("a-image");b.setAttribute("src","#asset-refresh"),b.setAttribute("scale","0.2 0.2 1"),b.setAttribute("position",`-0.3 ${h.height/2-.3} 0.02`),b.setAttribute("clickable",""),b.setAttribute("button-highlight",""),b.addEventListener("click",()=>{this.fetchFiles(e,t)}),e.appendChild(b);let u=document.createElement("a-image");if(u.setAttribute("src","#asset-back"),u.setAttribute("scale","0.2 0.2 1"),u.setAttribute("position",`0.3 ${h.height/2-.3} 0.02`),u.setAttribute("clickable",""),u.setAttribute("button-highlight",""),u.addEventListener("click",()=>{e.setAttribute(g,{url:t.substr(0,t.lastIndexOf("/"))})}),e.appendChild(u),i.length>p){if(n!=0){let a=document.createElement("a-image");a.setAttribute("src","#asset-up"),a.setAttribute("scale","0.2 0.2 1"),a.setAttribute("position","-1.2 0.75 0.02"),a.setAttribute("clickable",""),a.setAttribute("button-highlight",""),a.addEventListener("click",()=>{e.setAttribute(g,{offset:{...s,[t]:{files:n-p/2,folders:l}}})}),e.appendChild(a)}if(n+p<i.length){let a=document.createElement("a-image");a.setAttribute("src","#asset-up"),a.setAttribute("scale","0.2 -0.2 1"),a.setAttribute("position",`-1.2 ${_+.2+p*S+(S-.01)} 0.02`),a.setAttribute("clickable",""),a.setAttribute("button-highlight",""),a.addEventListener("click",()=>{e.setAttribute(g,{offset:{...s,[t]:{files:n+p/2,folders:l}}})}),e.appendChild(a)}}if(r.length>p){if(l!=0){let a=document.createElement("a-image");a.setAttribute("src","#asset-up"),a.setAttribute("scale","0.2 0.2 1"),a.setAttribute("position","1.2 0.75 0.02"),a.setAttribute("clickable",""),a.setAttribute("button-highlight",""),a.addEventListener("click",()=>{e.setAttribute(g,{offset:{...s,[t]:{files:n,folders:l-p/2}}})}),e.appendChild(a)}if(l+p<r.length){let a=document.createElement("a-image");a.setAttribute("src","#asset-up"),a.setAttribute("scale","0.2 -0.2 1"),a.setAttribute("position",`1.2 ${_+.2+p*S+(S-.01)} 0.02`),a.setAttribute("clickable",""),a.setAttribute("button-highlight",""),a.addEventListener("click",()=>{e.setAttribute(g,{offset:{...s,[t]:{files:n,folders:l+p/2}}})}),e.appendChild(a)}}{let a=document.createElement("a-plane");a.setAttribute("geometry","width:2; height: 0.2"),a.setAttribute("material","color: #2F9F1D;"),a.setAttribute("position","0 1.3 0.01"),a.setAttribute("clickable",""),a.setAttribute("button-highlight",""),a.onclick=async()=>{await ee("fs"),this.fetchFiles(this.el,""),e.setAttribute(g,{reRender:"rerender"})};let C=document.createElement("a-text");C.setAttribute("value","Choose Another Directory"),C.setAttribute("align","center"),C.setAttribute("width","2"),a.appendChild(C),e.appendChild(a)}}function ne(e,t,i,r,s){var h,b;e.replaceChildren(),e.setAttribute("clickable",""),e.object3D.visible=!0;let n=((h=s[t])==null?void 0:h.files)??0,l=((b=s[t])==null?void 0:b.folders)??0,d=_;for(let u=n;u<n+p;u++)if(u<i.length){let c=document.createElement("a-plane");c.setAttribute("geometry","width:2; height: 0.2"),c.setAttribute("material","color: #801D9F;"),c.setAttribute("position",`-1.2 ${d} 0.01`),c.setAttribute("clickable",""),c.setAttribute("button-highlight",""),c.onclick=async()=>{let a=ie+t+"/"+i[u];a=URL.createObjectURL(await this.fileHandles[u].getFile()),o.ascene.setAttribute(m,{src:a,fileName:i[u]})};let f=document.createElement("a-text");f.setAttribute("value",H(i[u]).substring(0,40)),f.setAttribute("align","center"),f.setAttribute("width","2"),c.appendChild(f),e.appendChild(c),d+=S}d=_;for(let u=l;u<l+p;u++)if(u<r.length){let c=document.createElement("a-plane");c.setAttribute("geometry","width:2; height: 0.2"),c.setAttribute("material","color: #C39807;"),c.setAttribute("position",`1.2 ${d} 0.01`),c.setAttribute("clickable",""),c.setAttribute("button-highlight",""),c.onclick=()=>{e.setAttribute(g,{url:t+"/"+r[u]}),console.log("going : ",t+"/"+r[u])};let f=document.createElement("a-text");f.setAttribute("value",H(r[u])),f.setAttribute("align","center"),f.setAttribute("width","2"),c.appendChild(f),e.appendChild(c),d+=S}this.insertFolderUI(e,t,i,r,s)}AFRAME.registerComponent(g,{schema:{url:{type:"string",default:""},filesFolders:{default:{files:[],folders:[]},parse:function(e){return typeof e=="object"?e:JSON.parse(e)},stringify:function(e){return typeof e=="string"?e:JSON.stringify(e)}},offset:{default:{"":{files:0,folders:0}},parse:function(e){return typeof e=="object"?e:JSON.parse(e)},stringify:function(e){return typeof e=="string"?e:JSON.stringify(e)}},reRender:{type:"string",default:""}},init:function(){let e=this.el;e.setAttribute("geometry","primitive: plane; width: 5; height: 2.1"),e.setAttribute("material","color: teal"),e.setAttribute("dialog-utils",{screen:g}),e.object3D.visible=!0,this.fetchFiles=AFRAME.utils.bind(se,this),this.insertFolderUI=AFRAME.utils.bind(re,this),this.renderFiles=AFRAME.utils.bind(ne,this)},update:function(e){var t=this.data,i=this.el;if(t.reRender&&t.reRender.length>0){i.setAttribute("dialog-utils",{screen:g}),i.setAttribute(g,{reRender:""});return}t.url!==e.url?this.fetchFiles(this.el,t.url):this.renderFiles(i,t.url,t.filesFolders.files,t.filesFolders.folders,t.offset)},remove:function(){let e=this.el;e.replaceChildren(),e.removeAttribute("clickable"),e.setAttribute("dialog-utils",{screen:""})}});const A="dialog-settings",I=4,D=-.3,U=.4,K=document.querySelector("a-scene");function le(e,t,i){var r=i;let s=document.createElement("a-plane");s.setAttribute("geometry","width:2; height: 0.2"),s.setAttribute("material","color: #A15807;"),s.setAttribute("position",`1.2 ${t} 0.01`),s.setAttribute("clickable",""),s.setAttribute("button-highlight","");let n=document.createElement("a-text");n.setAttribute("value",w[r].text),n.setAttribute("align","center"),n.setAttribute("width","2"),s.appendChild(n),s.onclick=()=>{r=(r+1)%w.length,n.setAttribute("value",w[r].text),console.log(r),o.ascene.setAttribute(y,{defaultPreset:r})},e.appendChild(s)}function ae(e,t,i){var r=["left","right"],s=r.indexOf(i);let n=document.createElement("a-plane");n.setAttribute("geometry","width:2; height: 0.2"),n.setAttribute("material","color: #A15807;"),n.setAttribute("position",`1.2 ${t} 0.01`),n.setAttribute("clickable",""),n.setAttribute("button-highlight","");let l=document.createElement("a-text");l.setAttribute("value",i),l.setAttribute("align","center"),l.setAttribute("width","2"),n.appendChild(l),n.onclick=()=>{s=(s+1)%r.length,l.setAttribute("value",r[s]),o.ascene.setAttribute(y,{defaultEye:r[s]})},e.appendChild(n)}function oe(e,t,i){var r=[!1,!0],s=r.indexOf(i);let n=document.createElement("a-plane");n.setAttribute("geometry","width:2; height: 0.2"),n.setAttribute("material","color: #A15807;"),n.setAttribute("position",`1.2 ${t} 0.01`),n.setAttribute("clickable",""),n.setAttribute("button-highlight","");let l=document.createElement("a-text");l.setAttribute("value",i?"ON":"OFF"),l.setAttribute("align","center"),l.setAttribute("width","2"),n.appendChild(l),n.onclick=()=>{let d=r[++s%r.length];l.setAttribute("value",d?"ON":"OFF"),o.ascene.setAttribute(y,{savePreset:d})},e.appendChild(n)}function de(e,t,i){var r=[!1,!0],s=r.indexOf(i);let n=document.createElement("a-plane");n.setAttribute("geometry","width:2; height: 0.2"),n.setAttribute("material","color: #A15807;"),n.setAttribute("position",`1.2 ${t} 0.01`),n.setAttribute("clickable",""),n.setAttribute("button-highlight","");let l=document.createElement("a-text");l.setAttribute("value",i?"ON":"OFF"),l.setAttribute("align","center"),l.setAttribute("width","2"),n.appendChild(l),n.addEventListener("click",()=>{let d=r[++s%r.length];l.setAttribute("value",d?"ON":"OFF"),K.setAttribute(y,{resumeVideo:d})}),e.appendChild(n)}const k=[{name:"default preset",render:le,storeKey:"defaultPreset"},{name:"save preset for video",render:oe,storeKey:"savePreset"},{name:"resume video",render:de,storeKey:"resumeVideo"},{name:"default eye",render:ae,storeKey:"defaultEye"}];function ue(e,t){let i=document.createElement("a-text"),r=e.getAttribute("geometry");if(i.setAttribute("value","Settings"),i.setAttribute("geometry",`primitive:plane; width:${r.width}; height: 0.2`),i.setAttribute("position",`0 ${r.height/2} 0.01`),i.setAttribute("material","color: grey"),i.setAttribute("align","center"),i.setAttribute("width","2"),e.appendChild(i),k.length>I){if(t!=0){let s=document.createElement("a-image");s.setAttribute("src","#asset-up"),s.setAttribute("scale","0.2 0.2 1"),s.setAttribute("position","0 0.75 0.02"),s.setAttribute("clickable",""),s.setAttribute("button-highlight",""),s.addEventListener("click",()=>{e.setAttribute(A,{offset:t-1})}),e.appendChild(s)}if(t+I<k.length){let s=document.createElement("a-image");s.setAttribute("src","#asset-up"),s.setAttribute("scale","0.2 -0.2 1"),s.setAttribute("position",`0 ${U+.2+I*D+(D-.01)} 0.02`),s.setAttribute("clickable",""),s.setAttribute("button-highlight",""),s.addEventListener("click",()=>{e.setAttribute(A,{offset:t+1})}),e.appendChild(s)}}}function ce(e,t){e.replaceChildren(),e.setAttribute("clickable",""),e.object3D.visible=!0,ue(e,t);let i=K.getAttribute(y),r=U;for(let s=t;s<t+I;s++)if(s<k.length){let n=document.createElement("a-plane");n.setAttribute("geometry","width:2; height: 0.2"),n.setAttribute("material","color: #801D9F;"),n.setAttribute("position",`-1.2 ${r} 0.01`),k[s].render(e,r,i[k[s].storeKey]);let l=document.createElement("a-text");l.setAttribute("value",k[s].name),l.setAttribute("align","center"),l.setAttribute("width","2"),n.appendChild(l),e.appendChild(n),r+=D}}AFRAME.registerComponent(A,{schema:{offset:{type:"number",default:0},resumeVideo:{type:"string",default:"ON"},reRender:{type:"string",default:""}},init:function(){let e=this.el;e.setAttribute("geometry","primitive: plane; width: 5; height: 2.1"),e.setAttribute("material","color: teal"),e.setAttribute("dialog-utils",{screen:A})},update:function(e){var t=this.data,i=this.el;if(t.reRender&&t.reRender.length>0){i.setAttribute("dialog-utils",{screen:A}),i.setAttribute(A,{reRender:""});return}ce(i,t.offset)},remove:function(){let e=this.el;e.replaceChildren(),e.removeAttribute("clickable"),e.setAttribute("dialog-utils",{screen:""})}});AFRAME.registerComponent("dialog-loading",{schema:{},init:function(){let e=this.el,t=this.loader=document.createElement("a-entity");t.setAttribute("geometry","primitive: plane; width: 5; height: 2.5"),t.setAttribute("material","color: teal; opacity: 0.2"),t.setAttribute("position","0 0 0.1"),t.setAttribute("clickable",""),e.appendChild(t);let i=document.createElement("a-image");i.setAttribute("src","#asset-loading"),i.setAttribute("position","0 0 0.01"),i.setAttribute("scale","0.5 0.5 1"),t.appendChild(i);let r=document.createElement("a-text");r.setAttribute("value","loading"),r.setAttribute("width",2),r.setAttribute("align","center"),r.setAttribute("position","0 -0.5 0.01"),t.appendChild(r)},remove:function(){this.el.contains(this.loader)&&this.el.removeChild(this.loader)}});AFRAME.registerComponent("dialog-utils",{schema:{screen:{type:"string",default:""}},init:function(){let e=this.el;e.sceneEl.addEventListener(R,t=>{if(t.detail!==P)return!1;e.object3D.visible=!1,e.removeAttribute("clickable"),e.replaceChildren()})}});AFRAME.registerComponent("eq-sphere",{schema:{eye:{type:"string",default:"left"},fov:{type:"number",default:180},side:{type:"string",default:"left"}},init:function(){let e=this.el.object3D.children[0],t=this.data,i=this.el.getAttribute("geometry"),r=new THREE.SphereGeometry(i.radius||100,i.segmentsWidth||32,i.segmentsHeight||32,Math.PI,Math.PI,0,Math.PI),s={repeat:{x:-.5,y:1},offset:{x:.5,y:0}};t.side==="right"&&(s.offset.x+=.5);let n=r.attributes.uv;for(let l=0;l<n.count;l++){const d=n.getX(l),h=n.getY(l);n.setXY(l,d*s.repeat.x+s.offset.x,h*s.repeat.y+s.offset.y)}n.needsUpdate=!0,e.geometry=r},update:function(e){let t=this.data,i=this.el.object3D.children[0];t.eye==="left"?i.layers.set(1):t.eye==="right"?i.layers.set(2):i.layers.set(0)}});AFRAME.registerComponent("equirectangular",{schema:{defaultEye:{type:"string",default:"left"},detail:{type:"number",default:32},uiHidden:{type:"boolean",default:!1}},init:function(){this.leftEye=L("a-entity",{geometry:`primitive:sphere; radius: 100; segmentsWidth: ${this.data.detail}; segmentsHeight: ${this.data.detail};`,material:"shader: flat; src: #video; side: back;"}),this.rightEye=L("a-entity",{geometry:`primitive:sphere; radius: 100; segmentsWidth: ${this.data.detail}; segmentsHeight: ${this.data.detail};`,material:"shader: flat; src: #video; side: back;"}),this.el.append(this.leftEye,this.rightEye)},update:function(e){let t=this.data,i="left",r="right",s=!0,n=!0;t.uiHidden||(t.defaultEye==="left"?(n=!1,i="both"):(s=!1,r="both")),this.leftEye.setAttribute("eq-sphere",{eye:i,fov:180,side:"left"}),this.rightEye.setAttribute("eq-sphere",{eye:r,fov:180,side:"right"}),this.leftEye.object3D.visible=s,this.rightEye.object3D.visible=n},remove:function(){this.el.removeChild(this.leftEye),this.el.removeChild(this.rightEye)}});AFRAME.registerComponent("fe-sphere",{schema:{eye:{type:"string",default:"left"},fov:{type:"number",default:180},side:{type:"string",default:"left"}},init:function(){let e=this.el.object3D.children[0],t=this.data,i=Math.PI,r=t.fov-180;t.fov&&(i+=Math.PI/180*r);let s=this.el.getAttribute("geometry"),n=new THREE.SphereGeometry(s.radius||100,s.segmentsWidth||32,s.segmentsHeight||32),l={repeat:{x:.5,y:1},offset:{x:0,y:0}};t.side==="right"&&(l.offset.x+=.5),n.rotateX(-Math.PI/2),n.rotateY(Math.PI);let d=n.attributes.uv;for(let h=0;h<d.count;h++){const b=d.getX(h),u=d.getY(h),c=2*Math.PI*b,a=Math.PI*u/i,C=.5+a*Math.cos(c),W=.5+a*Math.sin(c);d.setXY(h,C*l.repeat.x+l.offset.x,W*l.repeat.y+l.offset.y)}d.needsUpdate=!0,e.geometry=n,console.log(r),console.log(`${90-r/2}`),this.el.appendChild(L("a-entity",{geometry:`primitive:sphere; radius: 99; segmentsWidth: ${s.segmentsWidth||32}; segmentsHeight: 8; thetaStart: 0; thetaLength: ${90-r/2}`,material:"shader: flat; side: back; color: grey",rotation:"90 0 0"}))},update:function(e){let t=this.data,i=this.el.object3D.children[0];t.eye==="left"?i.layers.set(1):t.eye==="right"?i.layers.set(2):i.layers.set(0)}});AFRAME.registerComponent("fisheye",{schema:{fov:{type:"number",default:180},detail:{type:"number",default:32},defaultEye:{type:"string",default:"left"},uiHidden:{type:"boolean",default:!1}},init:function(){this.leftEye=L("a-entity",{geometry:`primitive:sphere; radius: 100; segmentsWidth: ${this.data.detail}; segmentsHeight: ${this.data.detail};`,material:"shader: flat; src: #video; side: back;"}),this.rightEye=L("a-entity",{geometry:`primitive:sphere; radius: 100; segmentsWidth: ${this.data.detail}; segmentsHeight: ${this.data.detail};`,material:"shader: flat; src: #video; side: back;"}),this.el.append(this.leftEye,this.rightEye)},update:function(e){let t=this.data,i="left",r="right",s=!0,n=!0;t.uiHidden||(t.defaultEye==="left"?(n=!1,i="both"):(s=!1,r="both")),this.leftEye.setAttribute("fe-sphere",{eye:i,fov:t.fov,side:"left"}),this.rightEye.setAttribute("fe-sphere",{eye:r,fov:t.fov,side:"right"}),this.leftEye.object3D.visible=s,this.rightEye.object3D.visible=n},remove:function(){this.el.removeChild(this.leftEye),this.el.removeChild(this.rightEye)}});function he(){function e(t){const r=t.target.files[0];r&&o.ascene.setAttribute(m,{src:URL.createObjectURL(r),fileName:r.name})}o.file.addEventListener("change",e)}AFRAME.registerComponent("btn-open-file",{schema:{},init:function(){let e=this.el;$("dialog");{he(),e.addEventListener("click",t=>{o.file.click()});return}}});AFRAME.registerComponent("btn-pause-play",{init:function(){let e=this.el;this.video=document.getElementById("video"),this.pausePlay=()=>{this.video.paused?this.video.play():this.video.pause()},this.onPause=()=>e.setAttribute("src","#asset-vp-play"),this.onPlay=()=>e.setAttribute("src","#asset-vp-pause"),e.addEventListener("click",this.pausePlay),this.video.addEventListener("playing",this.onPlay),this.video.addEventListener("pause",this.onPause)},remove:function(){el.removeEventListener("click",this.pausePlay),this.video.removeEventListener("playing",this.onPlay),this.video.removeEventListener("pause",this.onPause)}});AFRAME.registerComponent("btn-seek-back",{init:function(){let e=this.el;this.video=document.getElementById("video"),e.addEventListener("click",()=>{this.video.currentTime-=15})}});AFRAME.registerComponent("btn-seek-forw",{init:function(){let e=this.el;this.video=document.getElementById("video"),e.addEventListener("click",()=>{this.video.currentTime+=15})}});AFRAME.registerComponent("btn-vol",{schema:{vol:{type:"number",default:1}},init:function(){let e=this.el;this.setVolume=AFRAME.utils.bind(this.setVolume,this);let t=this.width=.65;e.setAttribute("geometry",{primitive:"plane",width:t+.05,height:.35}),e.setAttribute("material","color: #808080");let i=this.txt=document.createElement("a-text");i.setAttribute("width",2.5),i.setAttribute("align","center"),i.setAttribute("value","100"),i.setAttribute("position","0 0 0.011"),e.appendChild(i);let r=this.bar=document.createElement("a-entity");r.setAttribute("material","color: #005073"),r.setAttribute("position","0 0 0.01"),r.setAttribute("geometry",{primitive:"plane",width:t,height:.3}),this.el.appendChild(r),this.el.addEventListener("click",s=>{this.setVolume(s.detail.intersection.uv.x)}),this.setVolume(v.get("volume"))},setVolume:function(e){e>=.9&&(e=1),e<=.1&&(e=.1);let t=this.width*e,i=t/2;o.video.volume=e,v.set("volume",e),this.txt.setAttribute("value",`${Math.round(o.video.volume*100)}`),this.bar.setAttribute("position",`${i-this.width/2} 0 0.01`),this.bar.setAttribute("geometry",{width:t})}});AFRAME.registerComponent("btn-hide-controls",{init:function(){let e=this.el;e.addEventListener("click",()=>{e.sceneEl.systems.controls.hideControls()})}});AFRAME.registerComponent("btn-settings",{schema:{},init:function(){let e=this.el,t=document.getElementById("dialog");e.addEventListener("click",()=>{t.hasAttribute(A)?t.object3D.visible?t.getAttribute("dialog-utils").screen===A?(t.removeAttribute("clickable"),t.replaceChildren(),t.object3D.visible=!1):t.setAttribute(A,{reRender:"rerender"}):t.setAttribute(A,{reRender:"rerender"}):(t.setAttribute(A,""),t.object3D.visible=!0)})}});const o={ascene:document.querySelector("a-scene"),video:document.getElementById("video"),env:document.getElementById("env"),file:document.getElementById("fileInput"),cameraRig:document.getElementById("cameraRig")};
