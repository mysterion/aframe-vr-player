(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();function p(e){isNaN(e)&&(e=0);var i=new Date(null);return i.setSeconds(e),i.toISOString().substr(11,8)}AFRAME.registerComponent("timeline-listen",{init:function(){let e=document.getElementById("timeline"),i=document.getElementById("video"),t=document.getElementById("seek");this.video=i,this.seek=t,this.timeline=e,this.hoverEl=document.getElementById("hover"),this.hoverTextEl=document.getElementById("hover-text"),e.addEventListener("click",function(o){var r=e.getAttribute("geometry").width,n=o.detail.intersection.uv.x,l=n*r-r/2;i.currentTime=(n*i.duration).toFixed(2);let{x:c,y:a,z:u}=t.getAttribute("position");t.setAttribute("position",`${l} ${a} ${u}`)}),e.addEventListener("raycaster-intersected",o=>{this.raycaster=o.detail.el,this.hoverEl.setAttribute("visible",!0)}),e.addEventListener("raycaster-intersected-cleared",o=>{this.raycaster=null,this.hoverEl.setAttribute("visible",!1)})},tick:function(){var a,u,f;if(!this.raycaster)return;let e=this.raycaster.components.raycaster.getIntersection(this.timeline);if(!e||e.point.x===((a=this.previousIntersection)==null?void 0:a.x)&&e.point.y===((u=this.previousIntersection)==null?void 0:u.y)&&e.point.z===((f=this.previousIntersection)==null?void 0:f.z))return;let i=e.uv.x,t=timeline.getAttribute("geometry").width,o=i*t-t/2,r=Math.floor(i*video.duration),{x:n,y:l,z:c}=this.hoverEl.getAttribute("position");this.hoverEl.setAttribute("position",`${o} ${l} ${c}`),this.hoverTextEl.setAttribute("value",p(r)),this.previousIntersection=e.point}});AFRAME.registerComponent("setup",{init:function(){U()}});AFRAME.registerComponent("stereosphere",{schema:{eye:{type:"string",default:"left"},mode:{type:"string",default:"180SbsEq"},side:{type:"string",default:"left"},fishFov:{type:"int",default:180}},update:function(e){let i=this.el.object3D.children[0],t=this.data;if(t.mode==="180SbsEq"){let o=this.el.getAttribute("geometry"),r=new THREE.SphereGeometry(o.radius||100,o.segmentsWidth||32,o.segmentsHeight||32,Math.PI,Math.PI,0,Math.PI),n={repeat:{x:-.5,y:1},offset:{x:.5,y:0}};t.side==="right"&&(n.offset.x+=.5);let l=r.attributes.uv;for(let c=0;c<l.count;c++){const a=l.getX(c),u=l.getY(c);l.setXY(c,a*n.repeat.x+n.offset.x,u*n.repeat.y+n.offset.y)}l.needsUpdate=!0,i.geometry=r}else if(t.mode==="SbsFish"){let o=Math.PI;if(t.fishFov){let a=t.fishFov-180;o+=Math.PI/180*a}let r=this.el.getAttribute("geometry"),n=new THREE.SphereGeometry(r.radius||100,r.segmentsWidth||32,r.segmentsHeight||32),l={repeat:{x:.5,y:1},offset:{x:0,y:0}};t.side==="right"&&(l.offset.x+=.5),n.rotateX(-Math.PI/2),n.rotateY(Math.PI);let c=n.attributes.uv;for(let a=0;a<c.count;a++){const u=c.getX(a),f=c.getY(a),y=2*Math.PI*u,v=Math.PI*f/o,E=.5+v*Math.cos(y),h=.5+v*Math.sin(y);c.setXY(a,E*l.repeat.x+l.offset.x,h*l.repeat.y+l.offset.y)}c.needsUpdate=!0,i.geometry=n}t.eye==="left"?i.layers.set(1):t.eye==="right"?i.layers.set(2):i.layers.set(0)}});AFRAME.registerComponent("stereocam",{schema:{eye:{type:"string",default:"left"}},init:function(){console.log("initalized stereocam"),this.layer_changed=!1},tick:function(e){var i=this.data;if(!this.layer_changed){var t;this.el.object3D.children.forEach(function(o){o.type=="PerspectiveCamera"&&(t=o)}),t?i.eye==="left"?(t.layers.enable(1),t.layers.disable(2)):i.eye==="right"?(t.layers.enable(2),t.layers.disable(1)):(t.layers.enable(1),t.layers.enable(2)):console.error("stereocam: Camera not found")}}});function M(e,i){return e==="#FFF"&&(i*=-1),"#"+e.replace(/^#/,"").replace(/../g,t=>("0"+Math.min(255,Math.max(0,parseInt(t,16)+i)).toString(16)).substr(-2))}AFRAME.registerComponent("button-highlight",{init:function(){this.color=this.el.getAttribute("material").color,this.el.addEventListener("raycaster-intersected",e=>{this.el.setAttribute("material",{color:M(this.color,40)})}),this.el.addEventListener("raycaster-intersected-cleared",e=>{this.el.setAttribute("material",{color:this.color})})}});function k(e){const t=e.target.files[0];t&&(s.video.src=URL.createObjectURL(t))}const P=()=>{s.fileInput.click()},w=()=>{s.fileInput.addEventListener("change",k)},s={cursor:document.querySelector("#cursor"),cameraRig:document.querySelector("#cameraRig"),camRecenter:document.querySelector("#camRecenter"),cameraWrapper:document.querySelector("#cameraWrapper"),camera:document.querySelector("#camera"),video:document.querySelector("#video"),videoText:document.querySelector("#videoText"),controls:document.querySelector("#controls"),seek:document.querySelector("#seek"),timeline:document.querySelector("#timeline"),openFileBtn:document.querySelector("#openFileBtn"),seekBackwardBtn:document.querySelector("#seekBackwardBtn"),pausePlayBtn:document.querySelector("#pausePlayBtn"),seekForwardBtn:document.querySelector("#seekForwardBtn"),hideFilesBtn:document.querySelector("#hideFilesBtn"),hideUiBtn:document.querySelector("#hideUiBtn"),volIncrBtn:document.querySelector("#volIncrBtn"),volDecrBtn:document.querySelector("#volDecrBtn"),volumeTxt:document.querySelector("#volumeTxt"),toggleMode:document.querySelector("#toggleMode"),leftEye:document.querySelector("#leftEye"),rightEye:document.querySelector("#rightEye"),files:document.querySelector("#files"),loader:document.querySelector("#loader"),loaded:document.querySelector("#loaded"),filesList:document.querySelector("#filesList"),fileInput:document.querySelector("#fileInput"),CON:{HIDE_CONTROLS_TIMEOUT:5e3}};var g=!1;const B=[s.seek,s.timeline,s.seekBackwardBtn,s.pausePlayBtn,s.seekForwardBtn,s.hideUiBtn,s.openFileBtn,s.volIncrBtn,s.volDecrBtn,s.toggleMode];var T=0;const F=[{text:"180 SBS EQR",fn:()=>{s.leftEye.setAttribute("stereosphere","mode: 180SbsEq;"),s.rightEye.setAttribute("stereosphere","mode: 180SbsEq;")}},{text:"180 SBS FISH",fn:()=>{s.leftEye.setAttribute("stereosphere","mode: SbsFish; fishFov: 180"),s.rightEye.setAttribute("stereosphere","mode: SbsFish; fishFov: 180")}},{text:"190 SBS FISH",fn:()=>{s.leftEye.setAttribute("stereosphere","mode: SbsFish; fishFov: 190"),s.rightEye.setAttribute("stereosphere","mode: SbsFish; fishFov: 190")}},{text:"200 SBS FISH",fn:()=>{s.leftEye.setAttribute("stereosphere","mode: SbsFish; fishFov: 200"),s.rightEye.setAttribute("stereosphere","mode: SbsFish; fishFov: 200")}}],x=document.querySelector("a-scene");window.GS=s;function R(){{P();return}}function $(){let{openFileBtn:e,hideFilesBtn:i}=s;e.addEventListener("click",t=>R()),i.addEventListener("click",t=>void 0),w()}function O(){let{video:e,pausePlayBtn:i,seek:t,timeline:o,controls:r,hideUiBtn:n,volIncrBtn:l,volDecrBtn:c,volumeTxt:a,videoText:u,cursor:f,seekForwardBtn:y,seekBackwardBtn:b,toggleMode:v,CON:E}=s;e.src="static/sample.mp4",e.addEventListener("playing",()=>i.setAttribute("src","#asset-vp-pause")),e.addEventListener("pause",()=>i.setAttribute("src","#asset-vp-play")),i.addEventListener("click",d=>{e.paused?e.play():e.pause()}),n.addEventListener("click",d=>{r.setAttribute("visible",!1),f.setAttribute("visible",!1),s.rightEye.setAttribute("visible",!0),B.forEach(m=>m.removeAttribute("data-raycastable"))});var h=o.getAttribute("geometry").width;let{x:I,y:S,z:A}=t.getAttribute("position"),q=I-h/2;t.setAttribute("position",`${q} ${S} ${A}`),e.addEventListener("timeupdate",d=>{var m=e.currentTime/e.duration*h-h/2;t.setAttribute("position",`${m} ${S} ${A}`),u.setAttribute("text",{value:`${p(e.currentTime)}/${p(e.duration)}`})}),y.addEventListener("click",d=>{e.currentTime+=15}),b.addEventListener("click",d=>{e.currentTime-=15}),a.setAttribute("value",`${Math.round(e.volume*100)}%`),l.addEventListener("click",d=>{e.volume+.1>1?e.volume=1:e.volume+=.1,a.setAttribute("value",`${Math.round(e.volume*100)}%`)}),c.addEventListener("click",d=>{e.volume-.1<0?e.volume=0:e.volume-=.1,a.setAttribute("value",`${Math.round(e.volume*100)}%`)}),v.addEventListener("click",d=>{let{text:m,fn:L}=F[++T%F.length];s.toggleMode.setAttribute("value",m),L.call()})}function z(){let{camRecenter:e,camera:i,cameraWrapper:t,controls:o,cursor:r}=s;e.addEventListener("click",n=>{if(n.detail.intersectedEl!==s.camRecenter)return;if(!o.getAttribute("visible")){r.setAttribute("visible",!0),o.setAttribute("visible",!0),s.rightEye.setAttribute("visible",!1),B.forEach(c=>c.setAttribute("data-raycastable",!0));return}if(!g)return;let{y:l}=i.getAttribute("rotation");t.setAttribute("rotation",{x:0,y:-l,z:0})})}function U(){console.log("SETUP: Start"),z(),O(),$(),console.log("SETUP: End")}x.addEventListener("enter-vr",function(){g=!0,s.cameraRig.setAttribute("position",{x:0,y:-1.6,z:0})});x.addEventListener("exit-vr",function(){g=!1,s.cameraRig.setAttribute("position",{x:0,y:0,z:0})});
